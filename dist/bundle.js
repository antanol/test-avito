(()=>{"use strict";const e=[document.querySelector("canvas.hide-ending"),document.querySelector("#image-layer"),document.querySelector("#fill-layer"),document.querySelector("#text-layer")],t=[e[0].getContext("2d"),e[1].getContext("2d"),e[2].getContext("2d"),e[3].getContext("2d")];let r={width:200,height:300,currentImgSrc:!1,currentFill:!1,currentColor:!1,coordsGradient:!1,currentText:!1},i={maxWidth:r.width-10,startHeight:r.height/2,color:"gray",fontFamily:"BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif",fontSize:"16px"};function n(){t[3].clearRect(0,0,r.width,r.height);let e,i=document.querySelector("input[name='color-grade1']").value,n=document.querySelector("input[name='color-grade2']").value,o=document.querySelector("select[name='gradient-type']").value,l=document.querySelector("select[name='gradient-direction']").value,c=document.querySelector(".direction-linear"),d=document.querySelector(".direction-radial");switch(o){case"linear":let o,a,u,h;r.currentFill="linear",c.classList.contains("direction-hidden")&&(c.classList.remove("direction-hidden"),d.classList.add("direction-hidden")),"top"==l?(o=0,a=r.height,u=0,h=0):"left"==l?(o=r.width,a=0,u=0,h=0):"bottom"==l?(o=0,a=0,u=0,h=r.height):"right"==l?(o=0,a=0,u=r.width,h=0):"top left"==l?(o=r.width,a=r.height,u=0,h=0):"top right"==l?(o=0,a=r.height,u=r.width,h=0):"bottom left"==l?(o=r.width,a=0,u=0,h=r.height):"bottom right"==l&&(o=0,a=0,u=r.width,h=r.height),e=t[2].createLinearGradient(o,a,u,h),r.coordsGradient=[o,a,u,h],e.addColorStop(0,i),e.addColorStop(1,n),r.currentColor=[i,n],t[2].fillStyle=e,t[2].fillRect(0,0,r.width,r.height);break;case"radial":d.classList.contains("direction-hidden")&&(d.classList.remove("direction-hidden"),c.classList.add("direction-hidden")),e=t[2].createRadialGradient(120,100,r.height,0,0,30),e.addColorStop(0,i),e.addColorStop(1,n),r.currentColor=[i,n],t[2].fillStyle=e,t[2].fillRect(0,0,r.width,r.height)}}function o(){let e=document.querySelector("#direction-x").value,i=document.querySelector(".insert-x"),n=document.querySelector("#direction-y").value,o=document.querySelector(".insert-y"),l=document.querySelector("input[name='color-grade1']").value,c=document.querySelector("input[name='color-grade2']").value;i.innerText=Math.floor(100*e/r.width)+"%",o.innerText=Math.floor(100*n/r.height)+"%",t[2].clearRect(0,0,r.width,r.height);let d=t[2].createRadialGradient(120,100,r.height,e,n,30);r.coordsGradient=[120,100,r.height,e,n,30],d.addColorStop(0,l),d.addColorStop(1,c),t[2].fillStyle=d,t[2].fillRect(0,0,r.width,r.height)}function l(){t[3].clearRect(0,0,r.width,r.height);let e=document.querySelector("textarea[name='banner-text']");if(t[3].fillStyle=i.color,t[3].font=`${i.fontSize} ${i.fontFamily}`,Math.floor(t[3].measureText(e.value).width)>i.maxWidth){let n=function(e,t,r){let i=t.split(" "),n=[],o=i[0];for(let t=1;t<i.length;t++){let l=i[t];e.measureText(o+" "+l).width<r?o+=" "+l:(n.push(o),o=l)}return n.push(o),n}(t[3],e.value,i.maxWidth),o=i.startHeight;for(let e of n)t[3].fillText(e,10,o,i.maxWidth),o+=20;r.currentText=n}else t[3].fillText(e.value,10,i.startHeight,i.maxWidth),r.currentText=e.value}window.onload=()=>{let n=e[1].offsetWidth-2,o=e[1].offsetHeight-2;document.querySelector(".example-area-size").innerText=`${n}*${o}`,e[1].setAttribute("height",o),e[1].setAttribute("width",n),e[2].setAttribute("height",o),e[2].setAttribute("width",n),e[3].setAttribute("height",o),e[3].setAttribute("width",n),e[0].setAttribute("height",o),e[0].setAttribute("width",n),document.querySelector("#direction-x").setAttribute("max",n),document.querySelector("#direction-y").setAttribute("max",o);let l="Пример вашего баннера";t[3].fillStyle=i.color,t[3].font=`${i.fontSize} ${i.fontFamily}`,t[3].fillText(l,10,i.startHeight,i.maxWidth),r.width=n,r.height=o,r.currentText=l};let c=document.querySelectorAll("input[name='background-type']");for(let e of c)e.addEventListener("change",q);document.querySelector(".banner-image").addEventListener("input",(function(e){let i=e.target;if(i.files.length>1)document.querySelector(".error-field").innerText="Пожалуйста, выберите для баннера только одно изображение!";else{t[1].clearRect(0,0,r.width,r.height);let e=i.files[0],n=URL.createObjectURL(e),o=new Image;o.src=n,o.onload=function(){t[1].drawImage(o,0,0,r.width,r.width*o.height/o.width),r.currentImgSrc=n}}})),document.querySelector("input[name='color-plain']").addEventListener("input",(function(e){let i=e.target.value;t[2].clearRect(0,0,r.width,r.height),t[2].fillStyle=i,r.currentColor=i,t[2].fillRect(0,0,r.width,r.height)}));let d=document.querySelectorAll(".color-gradient"),a=document.querySelector("select[name='gradient-type']"),u=document.querySelector(".direction-linear"),h=document.getElementById("direction-x"),s=document.getElementById("direction-y");for(let e of d)e.addEventListener("input",n);a.addEventListener("input",n),u.addEventListener("input",n),h.addEventListener("input",o),s.addEventListener("input",o);let g=document.querySelector("textarea[name='banner-text']"),m=document.querySelector("input[name='text-size']"),f=document.querySelector("input[name='text-color']"),y=document.querySelector("input[name='text-direction']");g.addEventListener("input",l),m.addEventListener("input",(function(e){i.fontSize=e.target.value+"px",l()})),f.addEventListener("input",(function(e){i.color=e.target.value,l()})),y.addEventListener("input",(function(e){i.startHeight=e.target.value*r.height/100,l()}));let S=document.querySelector(".btn-save"),x=document.querySelector(".btn-PNG"),p=document.querySelector(".btn-HTML"),w=document.querySelector(".btn-JSON");function v(e,i,n){e[i]=n,"Пример вашего баннера"==r.currentText&&(r.currentText="",t[3].clearRect(0,0,r.width,r.height))}function q(e){let t=e.target.dataset.id,r=document.querySelectorAll(".sub");for(let e=0;e<r.length;e++)r[e].classList.contains("hidden-sub")||r[e].classList.add("hidden-sub");r[Number(t)].classList.remove("hidden-sub")}S.addEventListener("click",(function(){t[0].clearRect(0,0,r.width,r.height);let e=document.querySelectorAll(".sub-btn");for(let t of e)t.disabled=!1;if(r.currentImgSrc){let e=new Image;e.src=r.currentImgSrc,e.onload=function(){t[0].drawImage(e,0,0,r.width,r.width*e.height/e.width)}}if("mono"==r.currentFill)t[0].fillStyle=r.currentColor,t[0].fillRect(0,0,r.width,r.height);else if("linear"==r.currentFill){let e=t[0].createLinearGradient(r.coordsGradient[0],r.coordsGradient[1],r.coordsGradient[2],r.coordsGradient[3]);e.addColorStop(0,r.currentColor[0]),e.addColorStop(1,r.currentColor[1]),t[0].fillStyle=e,t[0].fillRect(0,0,r.width,r.height)}else if("radial"==r.currentFill){let e;e=0!=document.querySelector("#direction-x").value&&0!=document.querySelector("#direction-y").value?t[0].createRadialGradient(r.coordsGradient[0],r.coordsGradient[1],r.coordsGradient[2],r.coordsGradient[3],r.coordsGradient[4],r.coordsGradient[5]):t[0].createRadialGradient(120,100,r.height,0,0,30),e.addColorStop(0,r.currentColor[0]),e.addColorStop(1,r.currentColor[1]),t[0].fillStyle=e,t[0].fillRect(0,0,r.width,r.height)}if(r.currentText)if(t[0].fillStyle=i.color,t[0].font=`${i.fontSize} ${i.fontFamily}`,"string"==typeof r.currentText)t[0].fillText(r.currentText,10,i.startHeight,i.maxWidth);else{let e=i.startHeight;for(let n of r.currentText)t[0].fillText(n,10,e,i.maxWidth),e+=20}})),x.addEventListener("click",(function(){let t=e[0].toDataURL(),r=new Image;r.src=t;let i=document.createElement("a");i.setAttribute("href",r.src),i.setAttribute("download","yourBanner"),i.click()})),p.addEventListener("click",(function(){let t=e[0].toDataURL(),r=new Image;r.src=t;let i=`<img src = "${r.src}">`;navigator.clipboard.writeText(i).then((()=>{console.log(`Вы скопировали ${i}`)})).catch((e=>{console.log("Что-то пошло не так...",e)}))})),w.addEventListener("click",(function(){let t=e[0].toDataURL(),r=JSON.stringify(t);navigator.clipboard.writeText(r).then((()=>{console.log(`Вы скопировали ${r}`)})).catch((e=>{console.log("Что-то пошло не так...",e)}))})),document.oninput=function(e){e.target.classList.contains("banner-image")?v(r,"currentFill","image"):"color-plain"==e.target.name?v(r,"currentFill","mono"):"gradient-type"==e.target.name&&"linear"==e.target.value?v(r,"currentFill","linear"):"gradient-type"==e.target.name&&"radial"==e.target.value&&v(r,"currentFill","radial")}})();